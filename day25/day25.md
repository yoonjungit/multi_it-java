# 25일차

## [1] 정규화

### 1. 개념

```관계형 데이터베이스의 설계에서 중복을 최소화하게 데이터를 구조화하는 프로세스```

>이상(Anomaly)현상

```
- 삽입 이상 : 데이터 삽입 시 의도와 다른 값들도 삽입 ex) Null

- 삭제 이상 : 데이터 삭제 시 의도와 다른 값들도 연쇄 삭제

- 갱신 이상 : 속성 값 갱신 시 일부 튜플만 갱신되어 모순 발생

```

위와 같은 이상 현상을 방지 하기 위해 데이터 베이스를 정규화 시킨다.

>정규화 목적

- 중복을 배제하여 삽입, 삭제, 갱신 이상의 발생을 방지
 
- 각 릴레이션에 중복된 종속성을 여러개의 릴레이션에 분할

- 어떠한 릴레이션이라도 데이터베이스 내에서 표현 가능하게 함

- 데이터 삽입 시 릴레이션을 재구성할 필요성 감소

- 효과적인 검색 알고리즘 생성 가능

[출처](https://itwiki.kr/w/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4_%EC%A0%95%EA%B7%9C%ED%99%94#%EC%A0%95%EA%B7%9C%ED%99%94_%EA%B3%BC%EC%A0%95)

### 2. 정규화 과정

##### (1) 제 1정규형(1NF : 1 Normal Form)

- **원자 값**이어야 함 : 한 칸에는 하나의 정보만

>예시

|학생번호|학생이름|주소|학과|학과사무실|강좌명|강의실|성적|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|401|김연아|서울|체육학과|체육관 101|데이터베이스|공학관 110|4.0|
|402|장미란|강원도|체육학과|체육관 101|스포츠경영학|체육관 103|3.5|
|501|박지성|맨체스터|컴퓨터과|공학관 101|데이터베이스<br>자료구조|공학관 110<br>공학관 111|3.5<br>3.5|
|502|추신수|클리블랜드|컴퓨터과|공학관 101|자료구조|공학관 111|4.0|

```박지성 학생의 강좌명~성적 열에 강의가 두개가 들어가 있으므로, 나눠줘야 한다```

|학생번호|학생이름|주소|학과|학과사무실|강좌명|강의실|성적|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|401|김연아|서울|체육학과|체육관 101|데이터베이스|공학관 110|4.0|
|402|장미란|강원도|체육학과|체육관 101|스포츠경영학|체육관 103|3.5|
|501|박지성|맨체스터|컴퓨터과|공학관 101|데이터베이스|공학관 110|3.5|
|501|박지성|맨체스터|컴퓨터과|공학관 101|자료구조|공학관 111|3.5|
|502|추신수|클리블랜드|컴퓨터과|공학관 101|자료구조|공학관 111|4.0|


##### (2) 제 2정규형(2NF)

- **부분적 종속**(Partial Dependency)를 제거한 테이블. 

```
부분적 종속 : 복합키(Composite Primary Key : 두 개 이상의 컬럼을 Primary Key로 지정하는 것)로 지정된 컬럼 하나에만 종속되는 것
```

>예시

|학생번호|학생이름|주소|학과|학과사무실|강좌명|강의실|성적|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|401|김연아|서울|체육학과|체육관 101|데이터베이스|공학관 110|4.0|
|402|장미란|강원도|체육학과|체육관 101|스포츠경영학|체육관 103|3.5|
|501|박지성|맨체스터|컴퓨터과|공학관 101|데이터베이스|공학관 110|3.5|
|501|박지성|맨체스터|컴퓨터과|공학관 101|자료구조|공학관 111|3.5|
|502|추신수|클리블랜드|컴퓨터과|공학관 101|자료구조|공학관 111|4.0|


위의 표에서 `학생번호`와 `강좌명`으로 복합키를 만들 수 있다.

*Composite Primary Key(학생번호, 강좌명)*

이때, `학생이름`, `주소`, `학과`는 `학생번호`에 부분종속 되고, 

`강의실`도 마찬가지로 `강좌명`에만 부분종속 된다.

`학과 사무실`은 `학생번호`와 `강좌명`과 관계없이 `학과`에만 종속되며,

`성적`만이 `복합키`에 완전 종속 된다.

따라서 테이블을 다음과 같이 나눠줘야 한다.


|학생번호|학생이름|주소|학과|
|:---:|:---:|:---:|:---:|
|401|김연아|서울|체육학과|
|402|장미란|강원도|체육학과|
|501|박지성|맨체스터|컴퓨터과|
|502|추신수|클리블랜드|컴퓨터과|

|강좌명|강의실|
|:---:|:---:|
|데이터베이스|공학관 110|
|스포츠경영학|체육관 103|
|자료구조|공학관 111|

|학과|학과사무실|
|:---:|:---:|
|체육학과|체육관 101|
|컴퓨터과|공학관 101|

|학생번호|강좌명|성적|
|:---:|:---:|:---:|
|401|데이터베이스|4.0|
|402|스포츠경영학|3.5|
|501|데이터베이스|3.5|
|501|자료구조|3.5|
|502|자료구조|4.0|

- 중복되는 데이터 행은 제거하였다.

<br><br>

##### (3) 제 3정규형(3NF)

- **이행적 종속**(Transitive Dependency)를 제거

```
이행적 종속 : X, Y, Z 세 개의 요소가 있을 때, X→Y, Y→Z, X→Z, 즉 X→Y→Z 관계에 놓인 것
```

>예시

학과는 겹치지 않지만, 한 명이 여러 과의 학과장을 맡을 수 있다고 가정하면, `Composite Primary Key`는 없으며, 다음 테이블에서 `학과` 컬럼이 `Primary Key` 역할을 한다.

|학과|학과사무실|학과장|출신대학|
|:---:|:---:|:---:|:---:|
|체육학과|체육관 101|허재|중앙대|
|컴퓨터과|공학관 101|마크 주커버그|하버드|
|AI과|공학관102|마크 주커버그|하버드|

그러나 `출신대학`의 경우, 현재 테이블의 내용과 관련성이 떨어지며, 일반 컬럼인 `학과장`에만 종속되므로, 이를 따로 나눠줄 수 있다.

이행적 종속 관계 : `출신대학` → `학과장` → `학과`

|학과|학과사무실|학과장|
|:---:|:---:|:---:|
|체육학과|체육관 101|허재|
|컴퓨터과|공학관 101|마크 주커버그|
|AI과|공학관102|마크 주커버그|

|교수|출신대학|
|:---:|:---:|
|허재|중앙대|
|마크 주커버그|하버드|

```
즉, 
1NF : 원자값으로 테이블 정리
2NF : 부분종속 제거
3NF : 이행적 종속 제거
```

```
정규화 단점 : 예를 들어 위의 예시에서 체육학과 학과장의 출신대학이 궁금할 때 한 테이블만 봐서는 알 수 없으며, 두 개의 테이블을 모두 봐야한다.
```

[실습 예제](DAY25-1(정규화실습-대학교).sql)

- 테이블 생성 및 ERD

<p align="center"><img src="https://user-images.githubusercontent.com/64455378/224073738-f7f19c14-79f2-4699-a873-5d8f43b4bbc8.PNG" width=400> </p>

- 데이터 전체

<p align="center"><img src="https://user-images.githubusercontent.com/64455378/224074695-a620fd03-b7ca-4353-92f7-a36bd5ec1808.PNG" width=600> </p>

- 데이터 삭제 연산

<p align="center"><img src="https://user-images.githubusercontent.com/64455378/224074455-d0e523a3-6bd6-45fe-bd1b-172d604c9b3d.PNG" width=500> </p>


##### (4) BCNF : Boyce-Codd Normal Form

`강한 제 3정규형` 혹은 `3.5NF`라고도 함

```
모든 결정자는 후보키여야 한다. 즉 후보키가 아닌 속성은 결정자가 될 수 없다.
```

>예시

<수강과목>

|학번|과목명|교수명|
|:---:|:---:|:---:|
|210102|데이터베이스 설계|마크 주커버그|
|210102|자료구조|빌 게이츠|
|229201|데이터베이스 설계|마크 주커버그|
|229201|자료구조|팀 쿡|
|190234|데이터베이스 설계|제프 베이조스|
|230984|자료구조|빌 게이츠|

- 전제 : 각 `교수`는 `한 과목`만 담당할 수 있다.

따라서 `교수`로 `과목`을 알 수 있다. 또 같은 `과목`이 여러개 개설될 수도 있다.

위의 테이블을 보면 데이터베이스 설계는 마크 주커버그, 제프 베이조스가 담당하는 강의 두개가 개설되었다.

또 자료구조도 빌게이츠와 팀 쿡이 담당하는 강의 두개가 개설되었다.

따라서 위의 테이블에서 `학번`과 `과목명`이 복합키가 되어 `교수명`을 결정하고,

`교수명`이 `과목명`을 결정할 수 있다.

하지만 `교수명`은 후보키가 아니다. 

후보키란, 각 행을 유일하게 식별할 수 있는 "최소한"의 속성들의 집합이다. [후보키 설명 참고](https://sharpcoder.tistory.com/116)

여러 학생이 한 수업을 들을 수 있기 때문에 `교수명` 컬럼 하나로는 행들을 구분할 수 없다.

이 테이블에서 후보키는 복합키인 (학번, 과목명)이다.

따라서 BCNF를 만족 시키려면, 테이블을 [`학번`, `교수명`], [`과목명`, `교수명`] 으로 나눠야 한다. 

|학번|교수명|
|:---:|:---:|
|210102|마크 주커버그|
|210102|빌 게이츠|
|229201|마크 주커버그|
|229201|팀 쿡|
|190234|제프 베이조스|
|230984|빌 게이츠|


|과목명|교수명|
|:---:|:---:|
|데이터베이스 설계|마크 주커버그|
|데이터베이스 설계|제프 베이조스|
|자료구조|빌 게이츠|
|자료구조|팀 쿡|


## [2] 서브쿼리

>개념

SQL문을 실행하는 데 필요한 데이터를 추가로 조회하기 위해 SQL문 내부에서 사용하는 `SELECT`문

```SQL
SELECT 조회할열
    FROM 조회할 테이블
    WHERE 조건식(SELECT 조회할열
                FROM 조회할 테이블
                WHERE 조건식)
```

- 만약 서브쿼리 결과 데이터가 두개 이상 나오면 `WHERE 조건식 IN (서브쿼리)`<BR>
한개만 나오면 `WHERE 조건식 = (서브쿼리)`

- ORDERBY 절 사용 불가

>실습

<p align="center"><img src="" width=500> </p>


## [3] 자바 어플리케이션 구조

### 1. 개념

```
자바 GUI ---DTO--→ 자바 DAO ---SQL문--→ 오라클 DB
```

View에 해당하는 자바 GUI에서 사용자(클라이언트)가 입력한 데이터를 받아, 이를 오라클 DB로 전송을 하기 위해서는 중간에 `DTO(Data Transfer Object)`와 `DAO(Data Access Object)` 두 클래스를 거쳐야 한다.<br>

DTO와 DAO는 자바 디자인 패턴(Java Design Pattern)이다. 자바 디자인 패턴은 객체 지향 프로그래밍 시 직면하는 여러 문제 중 가장 실용적인 솔루션이다. [참고](https://www.tutorialspoint.com/design_pattern/index.htm) <br>

DTO의 경우 데이터를 한번에 클라이언트로부터 서버로 전송하기 위해 고안된 디자인 패턴이다. VO의 경우 객체의 주소(reference)가 아닌 값(value)을 비교하기 위해 고안된 디자인 패턴이다.

이를 간단히 비교하자면 다음과 같다. <br><br>

|비교 기준|DTO|VO|
|:---:|:---:|:---:|
|용도|레이어 간 데이터 전달|값 자체 표현<br>객체 비교시 주소가 아닌 값을 비교|
|동등 결정|속성값이 모두 같아도 같은 객체 아님|속성값이 모두 같으면 같은 객체|
|가변/불변|`setter` 존재 시 가변 <br>존재하지 않으면 불변|불변|
|로직|`getter`/`setter`만|`geter`/`setter`외의 로직 가능|


수업에서는 DTO와 VO를 구분하지 않았고, 또 getter/setter메소드 외에 toString()메소드도 사용 예정이므로 VO로 클래스를 생성했다. (이후에 나오는 DTO/VO 클래스 명칭을 신경쓰기 보다는 각 클래스의 기능과 역할에 초점을 둘 것)

<br><br>

DTO>

<p align="center"><img src="https://java-design-patterns.com/assets/data-transfer-object.urm-d5d2abfa.png" width=700></p>

VO>

<p align="center"><img src="https://java-design-patterns.com/assets/value-object-ba333b29.png" width=200> </p>

출처 : [DTO](https://java-design-patterns.com/patterns/data-transfer-object/#intent), 
[Value Object](https://java-design-patterns.com/patterns/value-object/#explanation)

### 2.DAO 클래스 구현

##### JDBC 프로그래밍

```
JDBC : 자바에서 데이터베이스에 접속할 수 있도록 하는 자바 API
```

```
<JDBC 프로그래밍 단계>

(1) 드라이버 로딩

(2) DB연결
            => DBCP 라이브러리
(3) SQL 객체화
            => 스프링, MYBATIS
(4) SQL 실행 요청
```

```java
// 1. 드라이버 로딩
Class.forName("oracle.jdbc.driver.OracleDriver");
			
// 2. DB 연결
// jdbc:연결할 DB=oracle:얇은버전:ip:포트번호:xe버전 
String url ="jdbc:oracle:thin:@localhost:1521:xe";
String user = "system";
String password = "oracle";
DriverManager.getConnection(url, user, password);
```

[실습예제](./src/javadb/dbconnect.java)